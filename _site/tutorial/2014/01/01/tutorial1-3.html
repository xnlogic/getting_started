<!DOCTYPE html>
<html>
  <head>
    <!-- Theme by Niklas Buschmann <http://github.com/niklasbuschmann> -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    
    <meta name="description" content="A collection of tutorials for the xnlogic framework.">
    <title> Getting started with xnlogic 
     - CRUD operations 
    </title>
    <link rel="canonical" href="/xnlogic_tutorials/tutorial/2014/01/01/tutorial1-3.html">
    <link href="/xnlogic_tutorials/main.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,200italic,300italic,400italic,600italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Gentium+Basic:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css' rel='stylesheet' type='text/css'>
    <link rel="alternate" type="application/rss+xml" title="xnlogic tutorials &raquo; Feed" href="/xnlogic_tutorials/feed.xml">
    
    
  </head>
  <body>
    <header>
      <a href="/xnlogic_tutorials/">
        <img class="center nav-image" src="/xnlogic_tutorials/assets/logo.png"/>
        <h1>Tutorials</h1>
      </a>
      
      

      <!--
      
      <h1><a href="/xnlogic_tutorials/"> xnlogic tutorials</a></h1>
      
      -->
      <!--
      <nav>
        <ul>
          <li><a href="/xnlogic_tutorials/">Home</a></li>
        </ul>
      </nav>
      -->
    </header>

    
    

        <article>

      <header>
        <h5>Getting started with xnlogic - Part 3</h5>
        <hr />
        <h1>CRUD operations</h1>
        <hr />
      </header>

      <div>
      <p>As mentioned in the <a href="/xnlogic_tutorials/tutorial/2014/01/01/tutorial1-2.html">previous part of this tutorial</a>, our data model has two types, <code>User</code> and <code>Tweet</code>. In this part of the tutorial, we will define our <code>User</code> type, and see how to perform <a href="http://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> operations using the API.</p>

<blockquote>
  <p><em>Note:</em> In xnlogic, we define a data model in terms of <a href="https://github.com/xnlogic/xn-gem-template/wiki/Data-Modeling,-Parts-and-Models">models and parts</a>.
In future tutorials, we will discuss these fundamental concepts in detail. 
For now, think of the words <em>part</em>, <em>model</em> and <em>type</em> as synonyms.</p>
</blockquote>

<h2 id="create-the-user-model">Create the <code>User</code> model</h2>

<blockquote>
  <p><em>Note:</em> All paths below are specified relative to the application root folder.</p>
</blockquote>

<p>Create the file <code>lib/my_app/parts/user.rb</code> with the following code:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">MyApp</span>
  <span class="k">module</span> <span class="nn">User</span>
    <span class="n">xn_part</span>

    <span class="n">property</span> <span class="ss">:username</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:text</span>
    <span class="n">property</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:text</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>Edit <code>lib/my_app/models.rb</code>, and add the following entry to the <code>client_models</code> hash:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="ss">user</span><span class="p">:</span> <span class="o">[</span><span class="no">User</span><span class="o">]</span></code></pre></div>

<blockquote>
  <p><em>Important:</em> The code above is <em>case sensitive</em>.</p>
</blockquote>

<p>We are now ready to perform CRUD operation using the REST API.</p>

<h2 id="send-api-requests">Send API requests</h2>

<p>Once your application is deployed to a server, any HTTP client can be used to access the API. During development, we find it convenient to avoid running a server, and simulate API requests from the console.</p>

<p>If you haven’t done so already, start the console (using the command <code>xn-console</code>). Next, get a reference to the application, by database name, and include its <code>console</code> module:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">jruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">18</span> <span class="p">:</span><span class="mo">001</span> <span class="o">&gt;</span> <span class="n">app</span> <span class="o">=</span> <span class="no">PM</span><span class="o">[</span><span class="s1">&#39;db01&#39;</span><span class="o">]</span>
<span class="n">jruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">18</span> <span class="p">:</span><span class="mo">002</span> <span class="o">&gt;</span> <span class="kp">include</span> <span class="n">app</span><span class="o">.</span><span class="n">console</span></code></pre></div>

<blockquote>
  <p>Once we include <code>app.console</code>, we can use the <code>xput</code>, <code>xget</code>, <code>xpath</code>, <code>xdelete</code> and <code>xpost</code> to simulate the corresponding HTTP request.</p>
</blockquote>

<h2 id="create">Create</h2>

<p>We create model objects using PUT requests.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">jruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">18</span> <span class="p">:</span><span class="mo">003</span> <span class="o">&gt;</span> <span class="n">xput</span> <span class="s1">&#39;/model/user&#39;</span><span class="p">,</span> <span class="p">{</span><span class="ss">username</span><span class="p">:</span> <span class="s1">&#39;jon&#39;</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s1">&#39;jon@xnlogic.com&#39;</span><span class="p">}</span>
<span class="n">jruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">18</span> <span class="p">:</span><span class="mo">004</span> <span class="o">&gt;</span> <span class="n">xput</span> <span class="s1">&#39;/model/user&#39;</span><span class="p">,</span> <span class="p">{</span><span class="ss">username</span><span class="p">:</span> <span class="s1">&#39;cynthia&#39;</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s1">&#39;sin.t.yeah@gmail.com&#39;</span><span class="p">}</span>
<span class="n">jruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">18</span> <span class="p">:</span><span class="mo">005</span> <span class="o">&gt;</span> <span class="n">xput</span> <span class="s1">&#39;/model/user&#39;</span><span class="p">,</span> <span class="p">{</span><span class="ss">username</span><span class="p">:</span> <span class="s1">&#39;randy.marsh&#39;</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s1">&#39;i.am@lorde.com&#39;</span><span class="p">}</span>
<span class="n">jruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">18</span> <span class="p">:</span><span class="mo">006</span> <span class="o">&gt;</span> <span class="n">xput</span> <span class="s1">&#39;/model/user&#39;</span><span class="p">,</span> <span class="p">{</span><span class="ss">username</span><span class="p">:</span> <span class="s1">&#39;cool.dude&#39;</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s1">&#39;billy@zane.com&#39;</span><span class="p">}</span></code></pre></div>

<h2 id="read">Read</h2>

<p>We read model objects using GET requests.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">jruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">18</span> <span class="p">:</span><span class="mo">007</span> <span class="o">&gt;</span> <span class="n">xget</span> <span class="s1">&#39;/model/user&#39;</span>
<span class="p">{</span><span class="ss">:meta</span><span class="o">=&gt;</span><span class="p">{</span><span class="ss">:xnid</span><span class="o">=&gt;</span><span class="s2">&quot;/model/user/id/71&quot;</span><span class="p">,</span> <span class="ss">:model_name</span><span class="o">=&gt;</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="ss">:rendered</span><span class="o">=&gt;[</span><span class="s2">&quot;record&quot;</span><span class="p">,</span> <span class="s2">&quot;has_notes&quot;</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="o">]</span><span class="p">,</span> <span class="ss">:format</span><span class="o">=&gt;</span><span class="s2">&quot;partial&quot;</span><span class="p">,</span> <span class="ss">:rel_limit</span><span class="o">=&gt;</span><span class="mi">50</span><span class="p">},</span> <span class="ss">:id</span><span class="o">=&gt;</span><span class="mi">71</span><span class="p">,</span> <span class="ss">:name</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span> <span class="ss">:model_name</span><span class="o">=&gt;</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="ss">:description</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span> <span class="ss">:created_at</span><span class="o">=&gt;</span><span class="mi">2015</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">18</span> <span class="mo">00</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">18</span> <span class="no">UTC</span><span class="p">,</span> <span class="ss">:username</span><span class="o">=&gt;</span><span class="s2">&quot;jon&quot;</span><span class="p">,</span> <span class="ss">:email</span><span class="o">=&gt;</span><span class="s2">&quot;jon@xnlogic.com&quot;</span><span class="p">,</span> <span class="ss">:display_name</span><span class="o">=&gt;</span><span class="mi">71</span><span class="p">}</span>
<span class="p">{</span><span class="ss">:meta</span><span class="o">=&gt;</span><span class="p">{</span><span class="ss">:xnid</span><span class="o">=&gt;</span><span class="s2">&quot;/model/user/id/73&quot;</span><span class="p">,</span> <span class="ss">:model_name</span><span class="o">=&gt;</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="ss">:rendered</span><span class="o">=&gt;[</span><span class="s2">&quot;record&quot;</span><span class="p">,</span> <span class="s2">&quot;has_notes&quot;</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="o">]</span><span class="p">,</span> <span class="ss">:format</span><span class="o">=&gt;</span><span class="s2">&quot;partial&quot;</span><span class="p">,</span> <span class="ss">:rel_limit</span><span class="o">=&gt;</span><span class="mi">50</span><span class="p">},</span> <span class="ss">:id</span><span class="o">=&gt;</span><span class="mi">73</span><span class="p">,</span> <span class="ss">:name</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span> <span class="ss">:model_name</span><span class="o">=&gt;</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="ss">:description</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span> <span class="ss">:created_at</span><span class="o">=&gt;</span><span class="mi">2015</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">18</span> <span class="mo">00</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">19</span> <span class="no">UTC</span><span class="p">,</span> <span class="ss">:username</span><span class="o">=&gt;</span><span class="s2">&quot;cynthia&quot;</span><span class="p">,</span> <span class="ss">:email</span><span class="o">=&gt;</span><span class="s2">&quot;sin.t.yeah@gmail.com&quot;</span><span class="p">,</span> <span class="ss">:display_name</span><span class="o">=&gt;</span><span class="mi">73</span><span class="p">}</span>
<span class="p">{</span><span class="ss">:meta</span><span class="o">=&gt;</span><span class="p">{</span><span class="ss">:xnid</span><span class="o">=&gt;</span><span class="s2">&quot;/model/user/id/75&quot;</span><span class="p">,</span> <span class="ss">:model_name</span><span class="o">=&gt;</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="ss">:rendered</span><span class="o">=&gt;[</span><span class="s2">&quot;record&quot;</span><span class="p">,</span> <span class="s2">&quot;has_notes&quot;</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="o">]</span><span class="p">,</span> <span class="ss">:format</span><span class="o">=&gt;</span><span class="s2">&quot;partial&quot;</span><span class="p">,</span> <span class="ss">:rel_limit</span><span class="o">=&gt;</span><span class="mi">50</span><span class="p">},</span> <span class="ss">:id</span><span class="o">=&gt;</span><span class="mi">75</span><span class="p">,</span> <span class="ss">:name</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span> <span class="ss">:model_name</span><span class="o">=&gt;</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="ss">:description</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span> <span class="ss">:created_at</span><span class="o">=&gt;</span><span class="mi">2015</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">18</span> <span class="mo">00</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">19</span> <span class="no">UTC</span><span class="p">,</span> <span class="ss">:username</span><span class="o">=&gt;</span><span class="s2">&quot;randy.marsh&quot;</span><span class="p">,</span> <span class="ss">:email</span><span class="o">=&gt;</span><span class="s2">&quot;i.am@lorde.com&quot;</span><span class="p">,</span> <span class="ss">:display_name</span><span class="o">=&gt;</span><span class="mi">75</span><span class="p">}</span>
<span class="p">{</span><span class="ss">:meta</span><span class="o">=&gt;</span><span class="p">{</span><span class="ss">:xnid</span><span class="o">=&gt;</span><span class="s2">&quot;/model/user/id/77&quot;</span><span class="p">,</span> <span class="ss">:model_name</span><span class="o">=&gt;</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="ss">:rendered</span><span class="o">=&gt;[</span><span class="s2">&quot;record&quot;</span><span class="p">,</span> <span class="s2">&quot;has_notes&quot;</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="o">]</span><span class="p">,</span> <span class="ss">:format</span><span class="o">=&gt;</span><span class="s2">&quot;partial&quot;</span><span class="p">,</span> <span class="ss">:rel_limit</span><span class="o">=&gt;</span><span class="mi">50</span><span class="p">},</span> <span class="ss">:id</span><span class="o">=&gt;</span><span class="mi">77</span><span class="p">,</span> <span class="ss">:name</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span> <span class="ss">:model_name</span><span class="o">=&gt;</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="ss">:description</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span> <span class="ss">:created_at</span><span class="o">=&gt;</span><span class="mi">2015</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">18</span> <span class="mo">00</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">20</span> <span class="no">UTC</span><span class="p">,</span> <span class="ss">:username</span><span class="o">=&gt;</span><span class="s2">&quot;cool.dude&quot;</span><span class="p">,</span> <span class="ss">:email</span><span class="o">=&gt;</span><span class="s2">&quot;billy@zane.com&quot;</span><span class="p">,</span> <span class="ss">:display_name</span><span class="o">=&gt;</span><span class="mi">77</span><span class="p">}</span>
<span class="ss">Total</span><span class="p">:</span> <span class="mi">4</span>
 <span class="o">=&gt;</span> <span class="c1">#&lt;V-Lucene(model_name:&quot;user&quot;) ~ 4 -&gt; V-Range(-1...100) -&gt; Obj-Map&gt;</span></code></pre></div>

<blockquote>
  <p><em>Note:</em> The server’s JSON response is printed as a Ruby object. </p>
</blockquote>

<blockquote>
  <p><em>Note:</em> The console output includes information about how the query is performed. This can be a useful debugging/inspection tool.</p>
</blockquote>

<p>If you are not interested in the server’s verbose response, you can ask for a specific property.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">jruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">18</span> <span class="p">:</span><span class="mo">00</span><span class="mi">8</span> <span class="o">&gt;</span> <span class="n">xget</span> <span class="s1">&#39;/model/user/properties/username&#39;</span>
<span class="o">[</span><span class="mi">71</span><span class="p">,</span> <span class="s2">&quot;jon&quot;</span><span class="o">]</span> <span class="o">[</span><span class="mi">73</span><span class="p">,</span> <span class="s2">&quot;cynthia&quot;</span><span class="o">]</span> <span class="o">[</span><span class="mi">75</span><span class="p">,</span> <span class="s2">&quot;randy.marsh&quot;</span><span class="o">]</span> <span class="o">[</span><span class="mi">77</span><span class="p">,</span> <span class="s2">&quot;cool.dude&quot;</span><span class="o">]</span>  
<span class="ss">Total</span><span class="p">:</span> <span class="mi">4</span>
 <span class="o">=&gt;</span> <span class="c1">#&lt;V-Lucene(model_name:&quot;user&quot;) ~ 4 -&gt; Obj-Map -&gt; Obj-Range(-1...100)&gt;</span></code></pre></div>

<p>Or a number of properties.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">jruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">18</span> <span class="p">:</span><span class="mo">00</span><span class="mi">9</span> <span class="o">&gt;</span> <span class="n">xget</span> <span class="s1">&#39;/model/user/properties/email,username&#39;</span>
<span class="o">[</span><span class="mi">71</span><span class="p">,</span> <span class="s2">&quot;jon@xnlogic.com&quot;</span><span class="p">,</span> <span class="s2">&quot;jon&quot;</span><span class="o">]</span> <span class="o">[</span><span class="mi">73</span><span class="p">,</span> <span class="s2">&quot;sin.t.yeah@gmail.com&quot;</span><span class="p">,</span> <span class="s2">&quot;cynthia&quot;</span><span class="o">]</span> <span class="o">[</span><span class="mi">75</span><span class="p">,</span> <span class="s2">&quot;i.am@lorde.com&quot;</span><span class="p">,</span> <span class="s2">&quot;randy.marsh&quot;</span><span class="o">]</span> <span class="o">[</span><span class="mi">77</span><span class="p">,</span> <span class="s2">&quot;billy@zane.com&quot;</span><span class="p">,</span> <span class="s2">&quot;cool.dude&quot;</span><span class="o">]</span>    
<span class="ss">Total</span><span class="p">:</span> <span class="mi">4</span>
 <span class="o">=&gt;</span> <span class="c1">#&lt;V-Lucene(model_name:&quot;user&quot;) ~ 4 -&gt; Obj-Map -&gt; Obj-Range(-1...100)&gt;</span></code></pre></div>

<p>If you are not interested in all users, you can get a specific user by id.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">jruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">18</span> <span class="p">:</span><span class="mo">010</span> <span class="o">&gt;</span> <span class="n">xget</span> <span class="s1">&#39;/model/user/id/71&#39;</span>
<span class="n">jruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">18</span> <span class="p">:</span><span class="mo">011</span> <span class="o">&gt;</span> <span class="n">xget</span> <span class="s1">&#39;/model/user/id/71/properties/email&#39;</span></code></pre></div>

<p>There are many <a href="https://github.com/xnlogic/xn-gem-template/wiki/REST-API#getting-vertices">additional features for reading data</a>, such as filter/search, limit, offset and more. These features will be covered in other tutorials.</p>

<h2 id="update">Update</h2>

<p>We update model objects using PATCH requests.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">jruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">18</span> <span class="p">:</span><span class="mo">014</span> <span class="o">&gt;</span> <span class="n">xpatch</span> <span class="s1">&#39;/model/user/id/71&#39;</span><span class="p">,</span> <span class="p">{</span><span class="ss">email</span><span class="p">:</span> <span class="s1">&#39;john@doe.com&#39;</span><span class="p">}</span></code></pre></div>

<h2 id="delete">Delete</h2>

<p>As expected, deleting an object is done using DELETE requests.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">jruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">18</span> <span class="p">:</span><span class="mo">015</span> <span class="o">&gt;</span> <span class="n">xdelete</span> <span class="s1">&#39;/model/user/id/71&#39;</span></code></pre></div>

<hr />

<p>At this point, we know how to perform CRUD operations on our model objects. In the next tutorial, we will see how to define (and use) relations between different model objects.</p>

      </div>

      <footer>

        <hr />

        
        <div class="article-nav-item prev-part">
          <a href="/xnlogic_tutorials/tutorial/2014/01/01/tutorial1-2.html">&laquo; Our data model</a> 
        </div>
        


        
        <div class="article-nav-item next-part">
          <a href="/xnlogic_tutorials/tutorial/2014/01/01/tutorial1-4.html">Relations, the basics &raquo;</a> 
        </div>
        
      </footer>

    </article>


    

    








    <footer>
      <!--
      <span><a href=""></a></span>
      <span><a href="http://xnlogic.com"><i class="fa fa-xnlogic-square"></i></a></span>
      <span>&copy; 2015</span>
      -->
    </footer>
  </body>
</html>
